<div class="em_passport w3-round-large w3-card-4">
    <div class="em_passport_header w3-round-medium" >
        {{!-- since the config has a reference of the Country, we just have to fetch it from there by using the anatomy nationality --}}
        <h2 class="em_passport_country_name">
            {{!-- from the country we fetch the government name to translate --}}
            {{#with (fetch CONFIG.EmConfig.COUNTRIES actor.system.info.nationality) as |country|}}
                {{#with (fetch ../CONFIG.EmConfig.GOVERNMENTS country.system.government.type) as |government| }}
                    {{i18n government.name}} {{i18n government.preposition}}
                {{/with }}
                    {{i18n country.system.name}}
                <img class="em_passport_country_icon" src="{{country.system.icon}}"  "systems/EM2E/resources/images/countries/bera/emblems/National_Emblem.png" width="32" height="32">
            {{/with}}
        </h2>
        <input class="em_passport_field em_passport_input em_inline-field em_halfSection" name="name" value="{{actor.name}}" style="max-width: calc(100% - 6px);" {{#unless (hasRole "KEEPER")}}readonly="true"{{/unless}}>
    </div>
    {{!-- contains passport data and portrait --}}
    <div class="em_form_inputContainer" style="max-width: 100%;">
        {{!-- the passport data fields --}}
        <div class="em_passport_fieldsContainer w3-section em_form_inputElement" style="flex: 0.8;"> {{!-- this fields should be stacked one below the other --}}
            {{!-- nationality --}}
            <div class="em_form_inputContainer">
                <label class="em_form_inputElement em_passport_field em_passport_label">{{i18n "em.actors.passport.fields.nationality"}}</label>
                <!--#region nationality -->
                {{!-- GM settable nationality --}}
                {{#if (hasRole "KEEPER")}}
                    <select class="em_form_inputElement em_passport_field em_passport_input em_inline-field em_noShadow" name="actor.system.info.nationality">
                        {{#each CONFIG.EmConfig.COUNTRIES as |country key|}}
                            <option class="w3-white" data-tosave="{{key}}" {{#if (eq key ../actor.system.info.nationality) }}selected="true"{{/if}}>{{key}}</option>
                        {{/each}}
                    </select>
                {{else}}
                    {{!-- population name --}}
                    {{#with (fetch CONFIG.EmConfig.COUNTRIES actor.system.info.nationality) as |country|}}
                        <input class="em_form_inputElement em_passport_field em_passport_input em_halfLeftMargin" name="pop_name" value="{{i18n country.system.population.name}}" readonly="true">
                    {{/with}}
                {{/if}}
                <!--#endregion -->
            </div>
            {{!-- sex --}}
            <div class="em_form_inputContainer">
                <label class="em_form_inputElement em_passport_field em_passport_label">{{i18n "em.actors.passport.fields.sex"}}</label>
                <select class="em_form_inputElement em_passport_field em_passport_input em_inline-field em_noShadow" name="actor.system.anatomy.sex" {{#unless (hasRole "KEEPER")}}readonly="true"{{/unless}}>
                    {{#each CONFIG.EmConfig.SEX as |this key|}}
                        <option class="w3-white w3-center" data-tosave="{{key}}" {{#if (eq key ../actor.system.anatomy.sex)}}selected="true"{{/if}}>
                            {{i18n this.short}} ({{i18n this.label}})
                        </option>
                    {{/each}}
                </select>
            </div>
            {{!-- birth date --}}
            <div class="em_form_inputContainer">
                <label class="em_form_inputElement em_passport_field em_passport_label" for="actor.system.info.origin.birthDate">{{i18n "em.actors.passport.fields.birthDate"}}</label>
                <input class="em_form_inputElement em_passport_field em_passport_input em_inline-field em_noShadow" type="date" name="actor.system.info.origin.birthDate" value="{{actor.system.info.origin.birthDate}}" {{#unless (hasRole "KEEPER")}}readonly="true"{{/unless}}>
            </div>
            {{!-- born in --}}
            <div class="em_form_inputContainer">
                <label class="em_form_inputElement em_passport_field em_passport_label" for="actor.system.info.origin.address">{{i18n "em.actors.passport.fields.born"}}</label>
                <input class="em_form_inputElement em_passport_field em_passport_input em_inline-field em_noShadow" type="text" name="actor.system.info.origin.address" value="{{actor.system.info.origin.address}}" {{#unless (hasRole "KEEPER")}}readonly="true"{{/unless}}>
            </div>
            {{!-- work --}}
            <div class="em_form_inputContainer">
                {{!-- this is a long... fetch --}} 
                <label class="em_form_inputElement em_passport_field em_passport_label">{{i18n "em.actors.passport.fields.work"}}</label>
                {{!-- first we fetch the current Growth cycle and from it we get the background--}}
                {{#with (fetch actor.system.anatomy.growthCycle  actor.system.anatomy.currentGrowthStage) as |stage|}} 
                    {{!-- then we fetch the background data from the config by using the key stored in the growthCycle.background --}}
                    {{log stage}}
                    {{#with (fetch ../CONFIG.EmConfig.BACKGROUNDS stage.background) as |background|}}
                        {{#if (hasRole "KEEPER") }} {{!-- if it's the keeper then we make the background settable--}}
                            {{!-- since backgrounds need to apply stats, 
                                changing a background cannot be done through an inline-field
                                but requires its own function 
                            --}}
                            <select class="em_form_inputElement em_passport_field em_passport_input em_noShadow">
                                {{#each ../../CONFIG.EmConfig.BACKGROUNDS as |job key|}}
                                    <option data-tosave="{{key}}" {{#if (eq key ../../stage.background)}}selected="true"{{/if}}>{{job.name}}</option>
                                {{/each}}
                            </select>
                        {{else}}
                            <input class="em_form_inputElement em_passport_field em_passport_input" name="actor.system.growthCycle.{{../stage.id}}.background" value="{{background.name}}" {{#unless (hasRole "KEEPER")}}readonly="true"{{/unless}}>
                        {{/if}}
                    {{/with}}
                {{/with}}
            </div>
        {{!--end of passport data --}}
        </div>
        {{!-- portrait 64x64 --}}
        <div class="em_passport_portraitContainer em_form_inputElement em_halfContainer w3-section" style="width: 64px;">
            <img class="em_passport_portrait w3-black w3-round-large em_halfTopMargin" src="{{actor.img}}" name="actor.img" data-edit="img" title="{{actor.name}}" width="64" height="64">
        </div>
    </div>
    




</div>